# make image
# > docker build -t line/lbm-builder:static -f builders/Dockerfile.static .
#
# run build
# > docker run -it --rm -v $(pwd):/code line/lbm-builder:static
#
# make image and run build
# > docker run -it --rm -v $(pwd):/code -e LBM_BUILD_OPTIONS=rocksdb $(docker build -f builders/Dockerfile.static -q .)

FROM rust:1.53

ENV LBM_BUILD_OPTIONS="goleveldb"

# install tools
RUN apt update && apt install -y cmake

# install go
WORKDIR /tmp
ADD https://golang.org/dl/go1.15.15.linux-amd64.tar.gz .
RUN tar -C /usr/local -xzf go1.15.15.linux-amd64.tar.gz
ENV PATH=/usr/local/go/bin:$PATH

WORKDIR /code

# copy build script
COPY builders/scripts/build-static.sh builders/scripts/build-static.sh

# build lbm
ENTRYPOINT builders/scripts/build-static.sh
